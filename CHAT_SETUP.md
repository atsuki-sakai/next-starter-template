# ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯Cloudflare Durable Objectsã‚’ä½¿ç”¨ã—ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

- **Next.js 15** - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **Cloudflare Durable Objects** - WebSocketæ¥ç¶šã¨ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ç®¡ç†
- **Drizzle ORM** - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
- **Cloudflare D1** - SQLiteãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **TypeScript** - å‹å®‰å…¨æ€§

## ğŸ“‹ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install
```

### 2. Cloudflare D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ
```bash
# D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ
npx wrangler d1 create chat-database

# å‡ºåŠ›ã•ã‚ŒãŸdatabase_idã‚’wrangler.jsonc ã® "database_id" ã«è¨­å®š
```

### 3. wrangler.jsonc ã®è¨­å®š
`wrangler.jsonc` ã® `d1_databases` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã® `database_id` ã‚’å®Ÿéš›ã®IDã«æ›´æ–°ã—ã¦ãã ã•ã„ï¼š

```jsonc
"d1_databases": [
  {
    "binding": "DB",
    "database_name": "chat-database",
    "database_id": "ã‚ãªãŸã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ID"
  }
]
```

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
npx wrangler d1 migrations apply chat-database --remote
```

### 5. ç’°å¢ƒå¤‰æ•°ã®è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
é–‹ç™ºç’°å¢ƒã§`.dev.vars`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š
```
CLOUDFLARE_ACCOUNT_ID=your-account-id
CLOUDFLARE_D1_DATABASE_ID=your-database-id
CLOUDFLARE_API_TOKEN=your-api-token
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### é–‹ç™ºç’°å¢ƒã§ã®å®Ÿè¡Œ
```bash
npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:3000` ã‚’é–‹ãã€ã€ŒJoin Chatã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ã«å‚åŠ ã§ãã¾ã™ã€‚

### æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
npm run deploy
```

## ğŸ”§ åˆ©ç”¨å¯èƒ½ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆ

- `npm run dev` - é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
- `npm run build` - ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
- `npm run deploy` - Cloudflareã«ãƒ‡ãƒ—ãƒ­ã‚¤
- `npm run db:generate` - Drizzleã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ
- `npm run db:migrate` - ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- `npm run db:studio` - Drizzle Studioèµ·å‹•

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ chat/[roomId]/     # ãƒãƒ£ãƒƒãƒˆãƒšãƒ¼ã‚¸
â”‚   â””â”€â”€ api/chat/          # API routes
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ChatRoom.tsx       # ãƒãƒ£ãƒƒãƒˆUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ durable-objects/
â”‚   â””â”€â”€ ChatRoom.ts        # Durable Objectã‚¯ãƒ©ã‚¹
â”œâ”€â”€ db/
â”‚   â””â”€â”€ schema.ts          # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ
â””â”€â”€ worker.ts              # Cloudflare Workerã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
```

## ğŸ”— ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®ä½¿ç”¨

1. ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®ã€ŒJoin Chatã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ã«å‚åŠ 
3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€å—ä¿¡ãŒå¯èƒ½
4. è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒæ™‚ã«å‚åŠ å¯èƒ½

## ğŸ¯ æ©Ÿèƒ½

- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼å‚åŠ /é€€å‡ºé€šçŸ¥
- âœ… ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã®æ°¸ç¶šåŒ–
- âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- âœ… WebSocketè‡ªå‹•å†æ¥ç¶š
- âœ… è¤‡æ•°ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ å¯¾å¿œ

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### WebSocketæ¥ç¶šã‚¨ãƒ©ãƒ¼
- Cloudflare WorkersãŒæ­£ã—ããƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- wrangler.jsonc ã®è¨­å®šãŒæ­£ã—ã„ã‹ç¢ºèª

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼
- D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼
- ä¾å­˜é–¢ä¿‚ãŒæ­£ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- TypeScriptã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèª: `npm run check`

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Cloudflare Durable Objects](https://developers.cloudflare.com/durable-objects/)
- [Cloudflare D1](https://developers.cloudflare.com/d1/)
- [Drizzle ORM](https://orm.drizzle.team/)
- [Next.js](https://nextjs.org/docs)